import{n as e,m as a,v as l,E as t,w as i,x as o,y as r,z as s,A as d,B as p,C as n,D as u,o as c}from"../element-plus/element-plus.fbbbfa29.js";import{G as m,F as f,_ as g}from"../index/index.7b73d109.js";import{g as b,_ as h,s as v}from"../../assets/index.755b2133.js";import{d as y,a2 as U,r as w,o as j,P as V,Q as _,J as F,K as z,u as S,w as x,c as B,X as L,a as P,U as k,t as C,b as D,ab as q,ac as T,H,V as $,n as A}from"../@vue/@vue.0c036a59.js";import{p as I}from"../@element-plus/@element-plus.4f9203c7.js";import{I as M}from"../index/index.3034571e.js";import"../lodash-es/lodash-es.6278a1be.js";import"../@vueuse/@vueuse.e440a3a6.js";import"../@popperjs/@popperjs.172738d4.js";import"../@ctrl/@ctrl.17547d95.js";import"../dayjs/dayjs.481ce33c.js";import"../axios/axios.d56fff3c.js";import"../async-validator/async-validator.234fb871.js";import"../memoize-one/memoize-one.f0fba034.js";import"../escape-html/escape-html.d572c0fd.js";import"../normalize-wheel-es/normalize-wheel-es.db30398b.js";import"../@floating-ui/@floating-ui.50900a5c.js";/* empty css                                     */import"../pinia/pinia.46e48237.js";import"../vue-demi/vue-demi.4f3c4c97.js";import"../vue-router/vue-router.fe365eba.js";import"../path-browserify/path-browserify.3d3258d8.js";import"../js-cookie/js-cookie.431252a9.js";import"../nprogress/nprogress.491658f2.js";const R=y({props:{hideUpload:Boolean,disabled:Boolean,fileList:{type:Array,required:!0},accept:{type:String,default:".jpg, .jpeg, .png"},sizeLimit:{type:Number,default:20},listType:{type:String,default:"picture-card"},onBeforeUpload:Function,onBeforeUploadPromise:Function,onUploadSuccess:{type:Function,required:!0},onPreview:{type:Function,required:!0},onChange:{type:Function,required:!0},onRemove:{type:Function,required:!0},onUploadFail:{type:Function,required:!0}},setup(t){const i=t,o=U({uploadHeaders:{Authorization:"Bearer "+b()},file:null}),r=w(),s=l=>{const t=i.accept.includes(l.name.toLowerCase().split(".").pop()),s=l.size<=1024*i.sizeLimit*1024;t||e.error("文件格式不正确"),s||e.error(`文件大小必须小于 ${i.sizeLimit}MB`);if(!(t&&s))return!1;if(i.onBeforeUpload){const a=i.onBeforeUpload(l);if(a)return e.error(a),!1}return i.onBeforeUploadPromise?i.onBeforeUploadPromise(l).then((()=>(o.file=l,r.value=a.service({lock:!0,text:"上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),!0))).catch((a=>(e.error(a),Promise.reject(a)))):(o.file=l,r.value=a.service({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),!0)},d=(a,l)=>{var t,s,d,p;if(200===a.code){const{data:e}=a;null==(t=i.onUploadSuccess)||t.call(i,e.filename)}else e.error(a.message||"上传文件失败"),null==(s=i.onUploadFail)||s.call(i,a.message,o.file);null==(p=(d=r.value).close)||p.call(d)},p=()=>{var a,l,t;e.error("上传文件失败"),null==(a=i.onUploadFail)||a.call(i,"上传文件失败",o.file),null==(t=(l=r.value).close)||t.call(l)};return(e,a)=>{const i=l;return j(),V(i,{limit:1,"list-type":t.listType,accept:t.accept,class:z([{"hide-upload":t.hideUpload,"disabled-upload":t.disabled}]),disabled:t.disabled,data:{},action:"https://adminapi.tobtt.cn//upload/file",headers:S(o).uploadHeaders,"on-preview":t.onPreview,"on-change":t.onChange,"on-remove":t.onRemove,"before-upload":s,"on-success":d,"on-error":p,"file-list":t.fileList},{default:_((()=>[F(e.$slots,"default")])),_:3},8,["list-type","accept","class","disabled","headers","on-preview","on-change","on-remove","file-list"])}}});const E=["src"];var Y=h(y({props:{disabled:Boolean,imageUrl:String,uploaderSize:{type:String,default:"large"},accept:{type:String,default:".jpg, .jpeg, .png"},isShowPreview:{type:Boolean,default:!0},sizeLimit:{type:Number,default:20},listType:{type:String,default:"picture-card"},onBeforeUpload:Function,onUploadSuccess:Function,onRemoveImage:Function,onUploadFail:Function,pixelLimit:Array,scaleLimit:Number},emits:["update:imageUrl"],setup(e,{emit:a}){const l=e,o=w(),r=w("https://adminapi.tobtt.cn/uploads/"),s=U({hideUpload:!1,fileList:[],imgPreviewDialogVisible:!1,file:null});x((()=>l.imageUrl),((e,a)=>{if(e){const e={name:l.imageUrl,url:`${r.value}${l.imageUrl}`};s.fileList=[e],s.hideUpload=!0,s.file=e}}));const d=()=>{s.hideUpload=!0},p=()=>{s.imgPreviewDialogVisible=!0},n=()=>{var e;s.fileList.shift(),s.file=null,s.hideUpload=!1,a("update:imageUrl",""),null==(e=l.onRemoveImage)||e.call(l)},u=e=>{var t,i;s.hideUpload=!0,null==(t=l.onUploadSuccess)||t.call(l,e),a("update:imageUrl",e),null==(i=o.value)||i.close()},c=e=>{var a;null==(a=l.onUploadFail)||a.call(l,e),setTimeout((()=>{n()}),0)};return(a,l)=>{const o=t,m=i;return j(),B("div",{class:z(["uploader-wrapper image-uploader",e.uploaderSize,{"hide-upload":S(s).hideUpload,"hide-preview":!e.isShowPreview}])},[L(R,{disabled:e.disabled,hideUpload:S(s).hideUpload,accept:e.accept,sizeLimit:e.sizeLimit,onBeforeUpload:e.onBeforeUpload,onRemove:n,onPreview:p,onChange:d,onUploadSuccess:u,onUploadFail:c,fileList:S(s).fileList},{default:_((()=>[L(o,{class:"avatar-uploader-icon"},{default:_((()=>[L(S(I))])),_:1})])),_:1},8,["disabled","hideUpload","accept","sizeLimit","onBeforeUpload","fileList"]),e.isShowPreview?(j(),V(m,{key:0,modal:!1,modelValue:S(s).imgPreviewDialogVisible,"onUpdate:modelValue":l[0]||(l[0]=e=>S(s).imgPreviewDialogVisible=e),title:"图片预览","custom-class":"preview-dialog",width:"600px"},{default:_((()=>[P("img",{src:r.value+e.imageUrl,alt:""},null,8,E)])),_:1},8,["modelValue"])):k("",!0)],2)}}}),[["__scopeId","data-v-b65cf72e"]]);const N={class:"warpper"},O={class:"operate-wrapper"},G={class:"operate-left-btn"},J=$("新增"),K=$("删除"),Q={class:"operate-right-btn"},W=$("导入"),X=$("导出"),Z=$("显示"),ee=$("隐藏"),ae=$("保存"),le=$("重置");var te=h(y({setup(a){const l=U({searchForm:{limit:10,page:1,title:"",type:""},formVisible:!1}),t=U({id:"",title:"",picture:"",type:"home",status:!0,describe:""}),b={home:"首页"},h=e=>{R.currentPage=1,l.searchForm=e,y()},y=async()=>{l.searchForm.page=R.currentPage,l.searchForm.limit=R.pageSize;const{list:e,total:a}=await(t=l.searchForm,v({url:"advertise",method:"get",params:t}));var t;R.data=e,R.total=a},V=w(),F=()=>{V.value.resetFields()},z=()=>{F(),t.id="",l.formVisible=!1},x=async()=>{var a,l;await V.value.validate(),t.id?await(a=t.id,l=t,v({url:`advertise/${a}`,method:"patch",data:l})):await(e=>v({url:"advertise",method:"post",data:e}))(t),y(),e({type:"success",message:t.id?"修改成功":"新增成功"}),z()},k=e=>{l.formVisible=!0,A((()=>{t.id=e.id,t.title=e.title,t.picture=e.picture,t.type=e.type}))},$=({id:a})=>{c.confirm("确定删除该广告, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(e=>v({url:`advertise/${e}`,method:"delete"}))(a),y(),e({type:"success",message:"删除成功!"})})).catch((()=>{}))},I=U({onClickSearch:h,onClickClear:h,filters:[{type:m.input,key:"title",label:"广告标题",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:m.select,key:"type",label:"广告位置",initialValue:"",options:[{label:"首页",value:"home"}],validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]}]}),R=U({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"广告标题",prop:"title"},{label:"广告位置",prop:"type",render:e=>b[e]},{label:"广告图",prop:"picture",width:"100",useSlot:!0},{label:"广告状态",prop:"status",render:e=>e?"显示":"隐藏"},{label:"广告描述",prop:"describe"},{label:"创建日期",prop:"createdAt",minWidth:"80",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"]}],operation:{label:"操作",width:"200",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit"},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDel"}]}}),E=U({title:[{required:!0,message:"请输入广告标题",trigger:"blur"}],status:[{required:!0,message:"请选择广告状态",trigger:"change"}],type:[{required:!0,message:"请选择广告位置",trigger:"change"}],picture:[{required:!0,message:"请上传广告图片",trigger:"change"}]}),{formVisible:te}=C(l);return D((()=>{y()})),(e,a)=>{const l=o,c=r,m=s,b=d,h=p,v=n,U=i;return j(),B("div",N,[L(f,q(T(S(I))),null,16),P("div",O,[P("div",G,[L(l,{plain:"",onClick:a[0]||(a[0]=e=>te.value=!0)},{default:_((()=>[J])),_:1}),L(l,{plain:"",type:"danger"},{default:_((()=>[K])),_:1})]),P("div",Q,[L(l,{type:"primary"},{default:_((()=>[W])),_:1}),L(l,{type:"primary"},{default:_((()=>[X])),_:1})])]),L(g,{tableOpts:S(R),onGetTableData:y,onHandleEdit:k,onHandleDel:$},{picture:_((e=>[L(M,{url:S("https://adminapi.tobtt.cn/uploads/")+e.value,size:64},null,8,["url"])])),_:1},8,["tableOpts"]),L(U,{title:(S(t).id?"编辑":"新增")+"广告",modelValue:S(te),"onUpdate:modelValue":a[8]||(a[8]=e=>H(te)?te.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":z},{default:_((()=>[L(S(u),{ref_key:"formEle",ref:V,model:S(t),rules:S(E),"label-width":"100px",class:"demo-form"},{default:_((()=>[L(m,{label:"广告标题",prop:"title"},{default:_((()=>[L(c,{modelValue:S(t).title,"onUpdate:modelValue":a[1]||(a[1]=e=>S(t).title=e),placeholder:"请填写广告标题"},null,8,["modelValue"])])),_:1}),L(m,{label:"广告位置",prop:"type"},{default:_((()=>[L(h,{modelValue:S(t).type,"onUpdate:modelValue":a[2]||(a[2]=e=>S(t).type=e),placeholder:"请选择广告位置"},{default:_((()=>[L(b,{label:"首页",value:"home"})])),_:1},8,["modelValue"])])),_:1}),L(m,{label:"广告位置",prop:"picture"},{default:_((()=>[L(Y,{class:"uploadFile",uploaderSize:"large",imageUrl:S(t).picture,"onUpdate:imageUrl":a[3]||(a[3]=e=>S(t).picture=e)},null,8,["imageUrl"])])),_:1}),L(m,{label:"广告状态",prop:"status"},{default:_((()=>[L(v,{modelValue:S(t).status,"onUpdate:modelValue":a[4]||(a[4]=e=>S(t).status=e),label:!0,size:"large"},{default:_((()=>[Z])),_:1},8,["modelValue"]),L(v,{modelValue:S(t).status,"onUpdate:modelValue":a[5]||(a[5]=e=>S(t).status=e),label:!1,size:"large"},{default:_((()=>[ee])),_:1},8,["modelValue"])])),_:1}),L(m,{label:"描述：",prop:"describe"},{default:_((()=>[L(c,{modelValue:S(t).describe,"onUpdate:modelValue":a[6]||(a[6]=e=>S(t).describe=e),type:"textarea"},null,8,["modelValue"])])),_:1}),L(m,null,{default:_((()=>[L(l,{type:"primary",onClick:x},{default:_((()=>[ae])),_:1}),L(l,{onClick:a[7]||(a[7]=e=>F())},{default:_((()=>[le])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-666cf565"]]);export{te as default};
