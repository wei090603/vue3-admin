import{x as e,i as a,y as l,z as t,A as r,B as s,w as o,D as i,n,o as m}from"../element-plus/element-plus.fbbbfa29.js";import{G as d,F as u,_ as p}from"../index/index.7b73d109.js";import{I as c}from"../index/index.3034571e.js";import{s as b,_ as g}from"../../assets/index.755b2133.js";import{b as f}from"../roles/roles.8c2ca8ac.js";import{d as h,a2 as v,r as y,t as V,b as j,o as w,c as _,X as k,ab as x,ac as F,u as z,a as U,Q as D,V as C,W as P,F as W,a6 as S,H,n as T,P as q}from"../@vue/@vue.0c036a59.js";import"../lodash-es/lodash-es.6278a1be.js";import"../@vueuse/@vueuse.e440a3a6.js";import"../@popperjs/@popperjs.172738d4.js";import"../@ctrl/@ctrl.17547d95.js";import"../dayjs/dayjs.481ce33c.js";import"../axios/axios.d56fff3c.js";import"../async-validator/async-validator.234fb871.js";import"../memoize-one/memoize-one.f0fba034.js";import"../escape-html/escape-html.d572c0fd.js";import"../normalize-wheel-es/normalize-wheel-es.db30398b.js";import"../@floating-ui/@floating-ui.50900a5c.js";import"../@element-plus/@element-plus.4f9203c7.js";/* empty css                                     */import"../pinia/pinia.46e48237.js";import"../vue-demi/vue-demi.4f3c4c97.js";import"../vue-router/vue-router.fe365eba.js";import"../path-browserify/path-browserify.3d3258d8.js";import"../js-cookie/js-cookie.431252a9.js";import"../nprogress/nprogress.491658f2.js";const E={class:"operate-wrapper"},M={class:"operate-left-btn"},O=C("新增"),Y=C("删除"),$={class:"operate-right-btn"},B=C("导入"),A=C("导出"),G=C("保存"),I=C("重置");var N=g(h({setup(g){const h=v({rolesData:[],searchForm:{limit:10,page:1,name:"",account:"",phone:""},formVisible:!1}),N=e=>{R.currentPage=1,h.searchForm=e,X()},R=v({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"用户名",prop:"account",minWidth:"80"},{label:"姓名",prop:"name",minWidth:"120"},{label:"邮箱",prop:"email",width:"160"},{label:"头像",prop:"avatar",width:"100",useSlot:!0},{label:"手机号",prop:"phone",minWidth:"120"},{label:"角色",prop:"roles",minWidth:"80",useSlot:!0},{label:"状态",prop:"status",minWidth:"80",useSlot:!0},{label:"备注",prop:"remark",minWidth:"100"},{label:"创建日期",prop:"createdAt",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"],minWidth:"100"}],operation:{label:"操作",width:"260",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit"},{label:"重置密码",type:"warning",icon:"el-icon-message",handleFunc:"handleRestPwd"},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDelete"}]}}),Q=v({onClickSearch:N,onClickClear:N,filters:[{type:d.input,key:"account",label:"用户名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:d.input,key:"name",label:"姓名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]}]}),X=async()=>{h.searchForm.page=R.currentPage,h.searchForm.limit=R.pageSize;const{list:e,total:a}=await(l=h.searchForm,b({url:"manager",method:"get",params:l}));var l;R.data=e,R.total=a},J=y(),K=()=>{J.value.resetFields()},L=()=>{K(),Z.id="",h.formVisible=!1},Z=v({id:"",name:"",account:"",email:"",phone:"",remark:"",roles:[]}),ee=v({account:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],email:[{required:!1,message:"请输入正确的邮箱地址",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"blur"}],phone:[{required:!1,trigger:"blur",validator:(e,a,l)=>{if(a){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(a))return l(new Error("请输入正确的手机号"))}l()},message:"手机号格式错误"}]}),ae=async()=>{var e,a,l;await(null==(e=J.value)?void 0:e.validate()),Z.id?await(a=Z.id,l=Z,b({url:`manager/${a}`,method:"patch",data:l})):await(e=>b({url:"manager",method:"post",data:e}))(Z),X(),n({type:"success",message:Z.id?"修改成功":"新增成功"}),L()},le=async e=>{m.confirm("确定重置该用户密码为123456, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var a;await(a=e.id,b({url:`manager/restPassword/${a}`,method:"patch"})),n({type:"success",message:"重置成功!"})})).catch((()=>{}))},te=async e=>{await(e=>b({url:`manager/status/${e}`,method:"patch"}))(e),X(),n({message:"修改成功",type:"success"})},re=e=>{h.formVisible=!0,T((()=>{Z.id=e.id,Z.account=e.account,Z.name=e.name,Z.phone=e.phone,Z.email=e.email;const a=e.roles.map((({id:e})=>e));Z.remark=e.remark,Z.roles=a}))},{rolesData:se,formVisible:oe}=V(h);return j((()=>{X(),(async()=>{h.rolesData=await f()})()})),(n,m)=>{const d=e,b=a,g=p,f=l,h=t,v=r,y=s,V=o;return w(),_(W,null,[k(u,x(F(z(Q))),null,16),U("div",E,[U("div",M,[k(d,{plain:"",onClick:m[0]||(m[0]=e=>oe.value=!0)},{default:D((()=>[O])),_:1}),k(d,{plain:"",type:"danger"},{default:D((()=>[Y])),_:1})]),U("div",$,[k(d,{type:"primary"},{default:D((()=>[B])),_:1}),k(d,{type:"primary"},{default:D((()=>[A])),_:1})])]),k(g,{tableOpts:z(R),"onUpdate:tableOpts":m[1]||(m[1]=e=>H(R)?R.value=e:R=e),onGetTableData:X,onHandleEdit:re,onHandleRestPwd:le},{avatar:D((e=>[k(c,{url:e.value,size:64},null,8,["url"])])),status:D((e=>[C(P(e.value?"启用":"禁用")+" ",1),k(b,{"active-color":"#409eff",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onChange:a=>te(e.data.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),roles:D((e=>[(w(!0),_(W,null,S(e.data.roles,(e=>(w(),_("span",{key:e.id},[k(d,{type:"success",size:"small"},{default:D((()=>[C(P(e.roleName),1)])),_:2},1024)])))),128))])),_:1},8,["tableOpts"]),k(V,{title:(z(Z).id?"编辑":"新增")+"用户",modelValue:z(oe),"onUpdate:modelValue":m[9]||(m[9]=e=>H(oe)?oe.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":L},{default:D((()=>[k(z(i),{model:z(Z),"status-icon":"",rules:z(ee),ref_key:"managerFormEle",ref:J,"label-width":"100px"},{default:D((()=>[k(h,{label:"用户名：",prop:"account"},{default:D((()=>[k(f,{modelValue:z(Z).account,"onUpdate:modelValue":m[2]||(m[2]=e=>z(Z).account=e),disabled:!!z(Z).id},null,8,["modelValue","disabled"])])),_:1}),k(h,{label:"姓名：",prop:"name"},{default:D((()=>[k(f,{modelValue:z(Z).name,"onUpdate:modelValue":m[3]||(m[3]=e=>z(Z).name=e)},null,8,["modelValue"])])),_:1}),k(h,{label:"角色：",prop:"roles"},{default:D((()=>[k(y,{modelValue:z(Z).roles,"onUpdate:modelValue":m[4]||(m[4]=e=>z(Z).roles=e),multiple:"",placeholder:"请选择",size:"default"},{default:D((()=>[(w(!0),_(W,null,S(z(se),(e=>(w(),q(v,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(h,{label:"邮箱：",prop:"email"},{default:D((()=>[k(f,{modelValue:z(Z).email,"onUpdate:modelValue":m[5]||(m[5]=e=>z(Z).email=e)},null,8,["modelValue"])])),_:1}),k(h,{label:"手机号码：",prop:"phone"},{default:D((()=>[k(f,{modelValue:z(Z).phone,"onUpdate:modelValue":m[6]||(m[6]=e=>z(Z).phone=e)},null,8,["modelValue"])])),_:1}),k(h,{label:"描述：",prop:"remark"},{default:D((()=>[k(f,{modelValue:z(Z).remark,"onUpdate:modelValue":m[7]||(m[7]=e=>z(Z).remark=e)},null,8,["modelValue"])])),_:1}),k(h,null,{default:D((()=>[k(d,{type:"primary",onClick:ae},{default:D((()=>[G])),_:1}),k(d,{onClick:m[8]||(m[8]=e=>K())},{default:D((()=>[I])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])],64)}}}),[["__scopeId","data-v-64422e1d"]]);export{N as default};
