import{f as e,a,b as l,e as t,r,c as s,d as o,y as i,z as n,x as d}from"./element-plus-6d3da066.js";import{G as m,F as u,_ as p}from"./index-ada1c84d.js";import{I as c}from"./index-8255de57.js";import{_ as b,m as f,b as g,c as h,d as y,e as V}from"./index-ca8e81d2.js";import{r as v}from"./roles-b0650734.js";import{d as j,a2 as _,r as k,t as w,b as x,o as F,c as U,X as z,ab as C,ac as D,u as W,a as P,Q as S,V as H,W as T,F as q,a6 as E,H as M,P as O,n as Y}from"./@vue-b1347690.js";import"./lodash-es-b6050654.js";import"./@vueuse-7bacca58.js";import"./@popperjs-91a2fff2.js";import"./@ctrl-eb0b847c.js";import"./dayjs-2378ce3f.js";import"./axios-aec7d438.js";import"./async-validator-ec45d329.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-eea50788.js";import"./@floating-ui-a9dc73ab.js";import"./@element-plus-e6cd7fa9.js";/* empty css                      */import"./pinia-89efd9b3.js";import"./vue-demi-5b9a0fa5.js";import"./vue-router-ef0e62c7.js";import"./nprogress-2caf32ee.js";import"./js-cookie-1db5286e.js";const B={class:"operate-wrapper"},G={class:"operate-left-btn"},I=H("新增"),N=H("删除"),R={class:"operate-right-btn"},A=H("导入"),Q=H("导出"),X=H("保存"),$=H("重置");var J=b(j({setup(b){const j=_({rolesData:[],searchForm:{limit:10,page:1,name:"",account:"",phone:""},formVisible:!1}),J=e=>{K.currentPage=1,j.searchForm=e,Z()},K=_({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"用户名",prop:"account",minWidth:"80"},{label:"姓名",prop:"name",minWidth:"120"},{label:"邮箱",prop:"email",width:"160"},{label:"头像",prop:"avatar",width:"100",useSlot:!0},{label:"手机号",prop:"phone",minWidth:"120"},{label:"角色",prop:"roles",minWidth:"120",useSlot:!0},{label:"状态",prop:"status",minWidth:"120",useSlot:!0},{label:"备注",prop:"remark",minWidth:"100"},{label:"创建日期",prop:"createdAt",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"],minWidth:"180"}],operation:{label:"操作",width:"260",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit"},{label:"重置密码",type:"warning",icon:"el-icon-message",handleFunc:"handleRestPwd"},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDelete"}]}}),L=_({onClickSearch:J,onClickClear:J,filters:[{type:m.input,key:"account",label:"用户名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:m.input,key:"name",label:"姓名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]}]}),Z=async()=>{j.searchForm.page=K.currentPage,j.searchForm.limit=K.pageSize;const{list:e,total:a}=await f(j.searchForm);K.data=e,K.total=a},ee=k(),ae=()=>{ee.value.resetFields()},le=()=>{ae(),te.id="",j.formVisible=!1},te=_({id:"",name:"",account:"",email:"",phone:"",remark:"",roles:[]}),re=_({account:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],email:[{required:!1,message:"请输入正确的邮箱地址",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"blur"}],phone:[{required:!1,trigger:"blur",validator:(e,a,l)=>{if(a){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(a))return l(new Error("请输入正确的手机号"))}l()},message:"手机号格式错误"}]}),se=async()=>{var e;await(null==(e=ee.value)?void 0:e.validate()),te.id?await g(te.id,te):await h(te),Z(),a({type:"success",message:te.id?"修改成功":"新增成功"}),le()},oe=async e=>{l.confirm("确定重置该用户密码为123456, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await y(e.id),a({type:"success",message:"重置成功!"})})).catch((()=>{}))},ie=e=>{j.formVisible=!0,Y((()=>{te.id=e.id,te.account=e.account,te.name=e.name,te.phone=e.phone,te.email=e.email;const a=e.roles.map((({id:e})=>e));te.remark=e.remark,te.roles=a}))},{rolesData:ne,formVisible:de}=w(j);return x((()=>{Z(),(async()=>{j.rolesData=await v()})()})),(l,m)=>{const b=t,f=r,g=p,h=s,y=o,v=i,j=n,_=d;return F(),U(q,null,[z(u,C(D(W(L))),null,16),P("div",B,[P("div",G,[z(b,{plain:"",onClick:m[0]||(m[0]=e=>de.value=!0)},{default:S((()=>[I])),_:1}),z(b,{plain:"",type:"danger"},{default:S((()=>[N])),_:1})]),P("div",R,[z(b,{type:"primary"},{default:S((()=>[A])),_:1}),z(b,{type:"primary"},{default:S((()=>[Q])),_:1})])]),z(g,{tableOpts:W(K),"onUpdate:tableOpts":m[1]||(m[1]=e=>M(K)?K.value=e:K=e),onGetTableData:Z,onHandleEdit:ie,onHandleRestPwd:oe},{avatar:S((e=>[z(c,{url:e.value,size:64},null,8,["url"])])),status:S((e=>[H(T(e.value?"启用":"禁用")+" ",1),z(f,{"active-color":"#409eff",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onChange:l=>(async e=>{await V(e),Z(),a({message:"修改成功",type:"success"})})(e.data.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),roles:S((e=>[(F(!0),U(q,null,E(e.data.roles,(e=>(F(),U("span",{key:e.id},[z(b,{type:"success",size:"small"},{default:S((()=>[H(T(e.roleName),1)])),_:2},1024)])))),128))])),_:1},8,["tableOpts"]),z(_,{title:(W(te).id?"编辑":"新增")+"用户",modelValue:W(de),"onUpdate:modelValue":m[9]||(m[9]=e=>M(de)?de.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":le},{default:S((()=>[z(W(e),{model:W(te),"status-icon":"",rules:W(re),ref_key:"managerFormEle",ref:ee,"label-width":"100px"},{default:S((()=>[z(y,{label:"用户名：",prop:"account"},{default:S((()=>[z(h,{modelValue:W(te).account,"onUpdate:modelValue":m[2]||(m[2]=e=>W(te).account=e),disabled:!!W(te).id},null,8,["modelValue","disabled"])])),_:1}),z(y,{label:"姓名：",prop:"name"},{default:S((()=>[z(h,{modelValue:W(te).name,"onUpdate:modelValue":m[3]||(m[3]=e=>W(te).name=e)},null,8,["modelValue"])])),_:1}),z(y,{label:"角色：",prop:"roles"},{default:S((()=>[z(j,{modelValue:W(te).roles,"onUpdate:modelValue":m[4]||(m[4]=e=>W(te).roles=e),multiple:"",placeholder:"请选择",size:"default"},{default:S((()=>[(F(!0),U(q,null,E(W(ne),(e=>(F(),O(v,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(y,{label:"邮箱：",prop:"email"},{default:S((()=>[z(h,{modelValue:W(te).email,"onUpdate:modelValue":m[5]||(m[5]=e=>W(te).email=e)},null,8,["modelValue"])])),_:1}),z(y,{label:"手机号码：",prop:"phone"},{default:S((()=>[z(h,{modelValue:W(te).phone,"onUpdate:modelValue":m[6]||(m[6]=e=>W(te).phone=e)},null,8,["modelValue"])])),_:1}),z(y,{label:"描述：",prop:"remark"},{default:S((()=>[z(h,{modelValue:W(te).remark,"onUpdate:modelValue":m[7]||(m[7]=e=>W(te).remark=e)},null,8,["modelValue"])])),_:1}),z(y,null,{default:S((()=>[z(b,{type:"primary",onClick:se},{default:S((()=>[X])),_:1}),z(b,{onClick:m[8]||(m[8]=e=>ae())},{default:S((()=>[$])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])],64)}}}),[["__scopeId","data-v-400ade16"]]);export{J as default};
