import{f as e,a,b as l,e as r,c as s,d as t,x as o,J as i}from"./element-plus-6d3da066.js";import{G as d,F as m,_ as n}from"./index-e2cea047.js";import{a as c,b as u,c as p,d as f,e as b,f as h}from"./roles-54572842.js";import{r as k}from"./resources-565a0324.js";import{d as y,r as g,a2 as j,b as v,t as V,o as w,c as _,X as x,ab as C,ac as F,u as N,a as D,Q as H,H as S,F as P,V as T,n as z}from"./@vue-b1347690.js";import"./lodash-es-b6050654.js";import"./@vueuse-7bacca58.js";import"./@popperjs-91a2fff2.js";import"./@ctrl-eb0b847c.js";import"./dayjs-2378ce3f.js";import"./axios-aec7d438.js";import"./async-validator-ec45d329.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-eea50788.js";import"./@floating-ui-a9dc73ab.js";import"./index-be24d8a3.js";/* empty css                      */import"./pinia-89efd9b3.js";import"./vue-demi-5b9a0fa5.js";import"./vue-router-ef0e62c7.js";import"./nprogress-2caf32ee.js";import"./js-cookie-1db5286e.js";const U={class:"operate-wrapper"},E={class:"operate-left-btn"},M=T("新增"),W=T("删除"),Y={class:"operate-right-btn"},K=T("导入"),O=T("导出"),q={class:"table-container"},A=T("保存"),B=T("重置"),G={class:"dialog-footer"},I=T("保存"),J=T("取消"),L=y({setup(y){const T=g(),L=j({rolesData:[],searchForm:{limit:10,page:1},formVisible:!1,resourcesData:[],resourcesVisible:!1}),Q=async()=>{L.searchForm.page=ne.currentPage,L.searchForm.limit=ne.pageSize;const{list:e,total:a}=await c(L.searchForm);ne.data=e,ne.total=a},X=()=>{T.value.resetFields()},R=()=>{X(),$.id="",L.formVisible=!1},Z=e=>{ne.currentPage=1,L.searchForm=e,Q()},$=j({id:"",mark:"",roleName:"",remark:""}),ee=j({id:""}),ae=j({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],mark:[{required:!0,message:"请输入角色标识",trigger:"blur"}]}),le=async()=>{await T.value.validate(),$.id?await u(+$.id,$):await p($),Q(),a({type:"success",message:$.id?"修改成功":"新增成功"}),R()},re=e=>{ce.value=!0,$.id=e.id,z((()=>{$.mark=e.mark,$.remark=e.remark,$.roleName=e.roleName}))},se=g(null),te=async({id:e})=>{L.resourcesVisible=!0,ee.id=e;const a=await f(+e);z((()=>{a.forEach((e=>{var a=se.value.getNode(e);a.isLeaf&&se.value.setChecked(a,!0)}))}))},oe=async()=>{const e=se.value.getCheckedKeys().concat(se.value.getHalfCheckedKeys());await b(+ee.id,{resourcesId:e}),ie(),a({type:"success",message:"修改成功"})},ie=()=>{se.value.setCheckedKeys([]),ee.id="",ue.value=!1},de=async({id:e})=>{l.confirm("确定删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await h(+e),a({type:"success",message:"删除成功!"})})).catch((()=>{}))},me=j({onClickSearch:Z,onClickClear:Z,filters:[{type:d.input,key:"roleName",label:"角色名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:d.date,key:"createdAt",label:"创建时间：",className:"date-range",initialValue:""}]}),ne=j({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"角色名",prop:"roleName",minWidth:"80"},{label:"标识",prop:"mark",minWidth:"80"},{label:"备注",prop:"remark",minWidth:"80"},{label:"创建日期",prop:"createdAt",minWidth:"80",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"]}],operation:{label:"操作",width:"300",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit",isShow:e=>"root"!==e.mark},{label:"分配权限",type:"primary",icon:"el-icon-message",handleFunc:"handlePermission",isShow:e=>"root"!==e.mark},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDelete",isShow:e=>"root"!==e.mark}]}});v((()=>{Q(),(async()=>{L.resourcesData=await k({})})()}));const{formVisible:ce,resourcesVisible:ue,resourcesData:pe}=V(L);return(a,l)=>{const d=r,c=s,u=t,p=o,f=i;return w(),_(P,null,[x(m,C(F(N(me))),null,16),D("div",U,[D("div",E,[x(d,{plain:"",onClick:l[0]||(l[0]=e=>ce.value=!0)},{default:H((()=>[M])),_:1}),x(d,{plain:"",type:"danger"},{default:H((()=>[W])),_:1})]),D("div",Y,[x(d,{type:"primary"},{default:H((()=>[K])),_:1}),x(d,{type:"primary",onClick:l[1]||(l[1]=()=>{})},{default:H((()=>[O])),_:1})])]),D("div",q,[x(n,{tableOpts:N(ne),onGetTableData:Q,onHandleEdit:re,onHandleDel:de,onHandlePermission:te},null,8,["tableOpts"])]),x(p,{title:(N($).id?"编辑":"新增")+"角色",modelValue:N(ce),"onUpdate:modelValue":l[5]||(l[5]=e=>S(ce)?ce.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":R},{default:H((()=>[x(N(e),{ref_key:"formEle",ref:T,model:N($),rules:N(ae),"status-icon":"","label-width":"100px",class:"demo-resourceForm"},{default:H((()=>[x(u,{label:"角色名称",prop:"roleName"},{default:H((()=>[x(c,{modelValue:N($).roleName,"onUpdate:modelValue":l[2]||(l[2]=e=>N($).roleName=e)},null,8,["modelValue"])])),_:1}),x(u,{label:"标识",prop:"mark"},{default:H((()=>[x(c,{modelValue:N($).mark,"onUpdate:modelValue":l[3]||(l[3]=e=>N($).mark=e)},null,8,["modelValue"])])),_:1}),x(u,{label:"角色描述",prop:"remark"},{default:H((()=>[x(c,{modelValue:N($).remark,"onUpdate:modelValue":l[4]||(l[4]=e=>N($).remark=e),type:"textarea"},null,8,["modelValue"])])),_:1}),x(u,null,{default:H((()=>[x(d,{type:"primary",onClick:le},{default:H((()=>[A])),_:1}),x(d,{onClick:X},{default:H((()=>[B])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),x(p,{title:"分配菜单",modelValue:N(ue),"onUpdate:modelValue":l[6]||(l[6]=e=>S(ue)?ue.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":ie},{footer:H((()=>[D("span",G,[x(d,{type:"primary",onClick:oe},{default:H((()=>[I])),_:1}),x(d,{onClick:ie},{default:H((()=>[J])),_:1})])])),default:H((()=>[x(f,{ref_key:"tree",ref:se,data:N(pe),"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:{label:"title"}},null,8,["data"])])),_:1},8,["modelValue"])],64)}}});export{L as default};
