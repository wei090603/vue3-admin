import{f as e,a,b as l,e as s,c as r,d as t,x as o,J as i}from"./element-plus-6d3da066.js";import{G as d,F as m,_ as n}from"./index-bf54a2b0.js";import{a as c,b as u,c as p,d as f,e as b,f as k}from"./roles-dc4831e5.js";import{r as y}from"./resources-eb5bbfc1.js";import{d as h,r as g,a2 as j,b as V,t as v,o as w,c as _,X as x,ab as F,ac as C,u as D,a as N,Q as H,H as S,F as T,V as z,n as P}from"./@vue-b1347690.js";import"./lodash-es-b6050654.js";import"./@vueuse-7bacca58.js";import"./@popperjs-91a2fff2.js";import"./@ctrl-eb0b847c.js";import"./dayjs-2378ce3f.js";import"./axios-aec7d438.js";import"./async-validator-ec45d329.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-eea50788.js";import"./@floating-ui-a9dc73ab.js";import"./index-2f4a0259.js";/* empty css                      */import"./pinia-89efd9b3.js";import"./vue-demi-5b9a0fa5.js";import"./vue-router-ef0e62c7.js";import"./nprogress-2caf32ee.js";import"./js-cookie-1db5286e.js";const U={class:"operate-wrapper"},M={class:"operate-left-btn"},R=z("新增"),W=z("删除"),Y={class:"operate-right-btn"},E=z("导入"),O=z("导出"),q={class:"table-container"},A=z("保存"),B=z("重置"),G={class:"dialog-footer"},K=z("保存"),I=z("取消"),J=h({setup(h){const z=g(),J=j({rolesData:[],searchForm:{limit:10,page:1},formVisible:!1,resourcesData:[],resourcesVisible:!1}),Q=async()=>{J.searchForm.page=ne.currentPage,J.searchForm.limit=ne.pageSize;const{list:e,total:a}=await c(J.searchForm);ne.data=e,ne.total=a},X=()=>{z.value.resetFields()},L=()=>{X(),$.id="",J.formVisible=!1},Z=e=>{},$=j({id:"",mark:"",roleName:"",remark:""}),ee=j({id:"",rolesResources:[]}),ae=j({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],mark:[{required:!0,message:"请输入角色标识",trigger:"blur"}]}),le=async()=>{await z.value.validate(),$.id?await u(+$.id,$):await p($),Q(),a({type:"success",message:$.id?"修改成功":"新增成功"}),L()},se=e=>{ce.value=!0,$.id=e.id,P((()=>{$.mark=e.mark,$.remark=e.remark,$.roleName=e.roleName}))},re=g(null),te=async({id:e})=>{J.resourcesVisible=!0,ee.id=e,ee.rolesResources=await f(+e)},oe=async()=>{await b(+ee.id,{resourcesId:re.value.getCheckedKeys()}),ie(),a({type:"success",message:"修改成功"})},ie=()=>{re.value.setCheckedKeys([]),ee.rolesResources=[],ee.id="",ue.value=!1},de=async({id:e})=>{l.confirm("确定删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await k(+e),a({type:"success",message:"删除成功!"})})).catch((()=>{}))},me=j({onClickSearch:Z,onClickClear:Z,filters:[{type:d.input,key:"roleName",label:"角色名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:d.date,key:"createdAt",label:"创建时间：",className:"date-range",initialValue:""}]}),ne=j({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"角色名",prop:"roleName",minWidth:"80"},{label:"标识",prop:"mark",minWidth:"80"},{label:"备注",prop:"remark",minWidth:"80"},{label:"创建日期",prop:"createdAt",minWidth:"80",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"]}],operation:{label:"操作",width:"300",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit",isShow:e=>"root"!==e.mark},{label:"分配权限",type:"primary",icon:"el-icon-message",handleFunc:"handlePermission",isShow:e=>"root"!==e.mark},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDelete",isShow:e=>"root"!==e.mark}]}});V((()=>{Q(),(async()=>{J.resourcesData=await y({})})()}));const{formVisible:ce,resourcesVisible:ue,resourcesData:pe}=v(J);return(a,l)=>{const d=s,c=r,u=t,p=o,f=i;return w(),_(T,null,[x(m,F(C(D(me))),null,16),N("div",U,[N("div",M,[x(d,{plain:"",onClick:l[0]||(l[0]=e=>ce.value=!0)},{default:H((()=>[R])),_:1}),x(d,{plain:"",type:"danger"},{default:H((()=>[W])),_:1})]),N("div",Y,[x(d,{type:"primary"},{default:H((()=>[E])),_:1}),x(d,{type:"primary",onClick:l[1]||(l[1]=()=>{})},{default:H((()=>[O])),_:1})])]),N("div",q,[x(n,{tableOpts:D(ne),onGetTableData:Q,onHandleEdit:se,onHandleDelete:de,onHandlePermission:te},null,8,["tableOpts"])]),x(p,{title:(D($).id?"编辑":"新增")+"角色",modelValue:D(ce),"onUpdate:modelValue":l[5]||(l[5]=e=>S(ce)?ce.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":L},{default:H((()=>[x(D(e),{ref_key:"formEle",ref:z,model:D($),rules:D(ae),"status-icon":"","label-width":"100px",class:"demo-resourceForm"},{default:H((()=>[x(u,{label:"角色名称",prop:"roleName"},{default:H((()=>[x(c,{modelValue:D($).roleName,"onUpdate:modelValue":l[2]||(l[2]=e=>D($).roleName=e)},null,8,["modelValue"])])),_:1}),x(u,{label:"标识",prop:"mark"},{default:H((()=>[x(c,{modelValue:D($).mark,"onUpdate:modelValue":l[3]||(l[3]=e=>D($).mark=e)},null,8,["modelValue"])])),_:1}),x(u,{label:"角色描述",prop:"remark"},{default:H((()=>[x(c,{modelValue:D($).remark,"onUpdate:modelValue":l[4]||(l[4]=e=>D($).remark=e),type:"textarea"},null,8,["modelValue"])])),_:1}),x(u,null,{default:H((()=>[x(d,{type:"primary",onClick:le},{default:H((()=>[A])),_:1}),x(d,{onClick:X},{default:H((()=>[B])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),x(p,{title:"分配菜单",modelValue:D(ue),"onUpdate:modelValue":l[6]||(l[6]=e=>S(ue)?ue.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":ie},{footer:H((()=>[N("span",G,[x(d,{type:"primary",onClick:oe},{default:H((()=>[K])),_:1}),x(d,{onClick:ie},{default:H((()=>[I])),_:1})])])),default:H((()=>[x(f,{ref_key:"tree",ref:re,data:D(pe),"show-checkbox":"","default-expand-all":"","default-checked-keys":D(ee).rolesResources,"node-key":"id","highlight-current":"",props:{label:"title"}},null,8,["data","default-checked-keys"])])),_:1},8,["modelValue"])],64)}}});export{J as default};
