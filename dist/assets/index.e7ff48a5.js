import{d as e,N as a,P as l,as as t,at as r,au as o,U as s,av as i,aw as n,ax as d,ay as u,ar as m,o as p,c,a as g,aA as b,aB as h,u as f,e as y,w as V,B as v,t as _,F as w,l as k,R as x,aC as F,a1 as U,a2 as j,aD as C,i as D}from"./vendor.2df3944f.js";/* empty css                  *//* empty css                  *//* empty css                */import{G as P,F as S,_ as W}from"./index.3a537d10.js";import{I as T}from"./index.2cf9d96c.js";import{s as q,_ as z}from"./index.348ad088.js";import{b as H}from"./roles.f27cdac5.js";/* empty css                    */const B={class:"operate-wrapper"},E={class:"operate-left-btn"},M=v("新增"),O=v("删除"),Y={class:"operate-right-btn"},$=v("导入"),N=v("导出"),R=v("保存"),A=v("重置");var G=z(e({setup(e){const z=a({rolesData:[],searchForm:{limit:10,page:1,name:"",account:"",phone:""},formVisible:!1}),G=e=>{I.currentPage=1,z.searchForm=e,K()},I=a({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"用户名",prop:"account",minWidth:"80"},{label:"姓名",prop:"name",minWidth:"120"},{label:"邮箱",prop:"email",width:"160"},{label:"头像",prop:"avatar",width:"100",useSlot:!0},{label:"手机号",prop:"phone",minWidth:"120"},{label:"角色",prop:"roles",minWidth:"80",useSlot:!0},{label:"状态",prop:"status",minWidth:"80",useSlot:!0},{label:"备注",prop:"remark",minWidth:"100"},{label:"创建日期",prop:"createdAt",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"],minWidth:"100"}],operation:{label:"操作",width:"260",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit"},{label:"重置密码",type:"warning",icon:"el-icon-message",handleFunc:"handleRestPwd"},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDelete"}]}}),J=a({onClickSearch:G,onClickClear:G,filters:[{type:P.input,key:"account",label:"用户名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:P.input,key:"name",label:"姓名：",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]}]}),K=async()=>{z.searchForm.page=I.currentPage,z.searchForm.limit=I.pageSize;const{list:e,total:a}=await(l=z.searchForm,q({url:"manager",method:"get",params:l}));var l;I.data=e,I.total=a},L=l(),Q=()=>{L.value.resetFields(),Z.id=""},X=()=>{Q(),z.formVisible=!1},Z=a({id:"",name:"",account:"",email:"",phone:"",remark:"",roles:[]}),ee=a({account:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],email:[{required:!1,message:"请输入正确的邮箱地址",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"blur"}],phone:[{required:!1,trigger:"blur",validator:(e,a,l)=>{if(a){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(a))return l(new Error("请输入正确的手机号"))}l()},message:"手机号格式错误"}]}),ae=async()=>{var e,a,l;await(null==(e=L.value)?void 0:e.validate()),Z.id?await(a=Z.id,l=Z,q({url:`manager/${a}`,method:"patch",data:l})):await(e=>q({url:"manager",method:"post",data:e}))(Z),K(),U({type:"success",message:Z.id?"修改成功":"新增成功"}),X()},le=async e=>{j.confirm("确定重置该用户密码为123456, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var a;await(a=e.id,q({url:`manager/restPassword/${a}`,method:"patch"})),U({type:"success",message:"重置成功!"})})).catch((()=>{}))},te=async e=>{await(e=>q({url:`manager/status/${e}`,method:"patch"}))(e),K(),U({message:"修改成功",type:"success"})},re=e=>{z.formVisible=!0,C((()=>{Z.id=e.id,Z.account=e.account,Z.name=e.name,Z.phone=e.phone,Z.email=e.email;const a=e.roles.map((({id:e})=>e));Z.remark=e.remark,Z.roles=a}))},{rolesData:oe,formVisible:se}=t(z);return r((()=>{K(),(async()=>{z.rolesData=await H()})()})),(e,a)=>{const l=o,t=s,r=W,U=i,j=n,C=d,P=u,q=m;return p(),c(w,null,[g(S,b(h(f(J))),null,16),y("div",B,[y("div",E,[g(l,{plain:"",onClick:a[0]||(a[0]=e=>se.value=!0)},{default:V((()=>[M])),_:1}),g(l,{plain:"",type:"danger"},{default:V((()=>[O])),_:1})]),y("div",Y,[g(l,{type:"primary"},{default:V((()=>[$])),_:1}),g(l,{type:"primary"},{default:V((()=>[N])),_:1})])]),g(r,{tableOpts:f(I),"onUpdate:tableOpts":a[1]||(a[1]=e=>x(I)?I.value=e:I=e),onGetTableData:K,onHandleEdit:re,onHandleRestPwd:le},{avatar:V((e=>[g(T,{url:e.value,size:64},null,8,["url"])])),status:V((e=>[v(_(e.value?"启用":"禁用")+" ",1),g(t,{"active-color":"#409eff",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onChange:a=>te(e.data.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),roles:V((e=>[(p(!0),c(w,null,k(e.data.roles,(e=>(p(),c("span",{key:e.id},[g(l,{type:"success",size:"small"},{default:V((()=>[v(_(e.roleName),1)])),_:2},1024)])))),128))])),_:1},8,["tableOpts"]),g(q,{title:(f(Z).id?"编辑":"新增")+"用户",modelValue:f(se),"onUpdate:modelValue":a[9]||(a[9]=e=>x(se)?se.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":X},{default:V((()=>[g(f(F),{model:f(Z),"status-icon":"",rules:f(ee),ref_key:"managerFormEle",ref:L,"label-width":"100px"},{default:V((()=>[g(j,{label:"用户名：",prop:"account"},{default:V((()=>[g(U,{modelValue:f(Z).account,"onUpdate:modelValue":a[2]||(a[2]=e=>f(Z).account=e),disabled:!!f(Z).id},null,8,["modelValue","disabled"])])),_:1}),g(j,{label:"姓名：",prop:"name"},{default:V((()=>[g(U,{modelValue:f(Z).name,"onUpdate:modelValue":a[3]||(a[3]=e=>f(Z).name=e)},null,8,["modelValue"])])),_:1}),g(j,{label:"角色：",prop:"roles"},{default:V((()=>[g(P,{modelValue:f(Z).roles,"onUpdate:modelValue":a[4]||(a[4]=e=>f(Z).roles=e),multiple:"",placeholder:"请选择",size:"default"},{default:V((()=>[(p(!0),c(w,null,k(f(oe),(e=>(p(),D(C,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),g(j,{label:"邮箱：",prop:"email"},{default:V((()=>[g(U,{modelValue:f(Z).email,"onUpdate:modelValue":a[5]||(a[5]=e=>f(Z).email=e)},null,8,["modelValue"])])),_:1}),g(j,{label:"手机号码：",prop:"phone"},{default:V((()=>[g(U,{modelValue:f(Z).phone,"onUpdate:modelValue":a[6]||(a[6]=e=>f(Z).phone=e)},null,8,["modelValue"])])),_:1}),g(j,{label:"描述：",prop:"remark"},{default:V((()=>[g(U,{modelValue:f(Z).remark,"onUpdate:modelValue":a[7]||(a[7]=e=>f(Z).remark=e)},null,8,["modelValue"])])),_:1}),g(j,null,{default:V((()=>[g(l,{type:"primary",onClick:ae},{default:V((()=>[R])),_:1}),g(l,{onClick:a[8]||(a[8]=e=>Q())},{default:V((()=>[A])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])],64)}}}),[["__scopeId","data-v-6b4e7c28"]]);export{G as default};
