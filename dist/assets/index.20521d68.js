import{d as e,a,o as l,c as t,b as i,r as o,g as r,e as s,f as d,w as n,h as p,n as u,u as c,E as m,i as g,j as f,_ as h,k as b,l as v,m as y,p as U,q as w,s as V,t as F,v as _,x as S,y as B,z as x,A as z,B as L,C as P,D as k,F as j,G as C,H as q,I as D,J as H,K as T}from"./index.83fac2ba.js";/* empty css                  *//* empty css                 *//* empty css                  *//* empty css                */import{G as I,F as M,_ as $}from"./index.d9bd8e3f.js";import{I as A}from"./index.4f26f9fd.js";/* empty css                    */const R=e({name:"Plus"}),E={class:"icon",width:"200",height:"200",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Y=[i("path",{fill:"currentColor",d:"M480 480V128a32 32 0 0164 0v352h352a32 32 0 110 64H544v352a32 32 0 11-64 0V544H128a32 32 0 010-64h352z"},null,-1)];var G=a(R,[["render",function(e,a,i,o,r,s){return l(),t("svg",E,Y)}]]);const N=e({props:{hideUpload:Boolean,disabled:Boolean,fileList:{type:Array,required:!0},accept:{type:String,default:".jpg, .jpeg, .png"},sizeLimit:{type:Number,default:20},listType:{type:String,default:"picture-card"},onBeforeUpload:Function,onBeforeUploadPromise:Function,onUploadSuccess:{type:Function,required:!0},onPreview:{type:Function,required:!0},onChange:{type:Function,required:!0},onRemove:{type:Function,required:!0},onUploadFail:{type:Function,required:!0}},setup(e){const a=e,t=o({uploadHeaders:{Authorization:"Bearer "+r()},file:null}),i=s(),h=e=>{const l=a.accept.includes(e.name.toLowerCase().split(".").pop()),o=e.size<=1024*a.sizeLimit*1024;l||m.error("文件格式不正确"),o||m.error(`文件大小必须小于 ${a.sizeLimit}MB`);if(!(l&&o))return!1;if(a.onBeforeUpload){const l=a.onBeforeUpload(e);if(l)return m.error(l),!1}return a.onBeforeUploadPromise?a.onBeforeUploadPromise(e).then((()=>(t.file=e,i.value=g.service({lock:!0,text:"上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),!0))).catch((e=>(m.error(e),Promise.reject(e)))):(t.file=e,i.value=g.service({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),!0)},b=(e,l)=>{var o,r,s,d;if(200===e.code){const{data:l}=e;null==(o=a.onUploadSuccess)||o.call(a,l.filename)}else m.error(e.message||"上传文件失败"),null==(r=a.onUploadFail)||r.call(a,e.message,t.file);null==(d=(s=i.value).close)||d.call(s)},v=()=>{var e,l,o;m.error("上传文件失败"),null==(e=a.onUploadFail)||e.call(a,"上传文件失败",t.file),null==(o=(l=i.value).close)||o.call(l)};return(a,i)=>{const o=f;return l(),d(o,{limit:1,"list-type":e.listType,accept:e.accept,class:u([{"hide-upload":e.hideUpload,"disabled-upload":e.disabled}]),disabled:e.disabled,data:{},action:"https://adminapi.tobtt.cn//upload/file",headers:c(t).uploadHeaders,"on-preview":e.onPreview,"on-change":e.onChange,"on-remove":e.onRemove,"before-upload":h,"on-success":b,"on-error":v,"file-list":e.fileList},{default:n((()=>[p(a.$slots,"default")])),_:3},8,["list-type","accept","class","disabled","headers","on-preview","on-change","on-remove","file-list"])}}});const O=["src"];var J=h(e({props:{disabled:Boolean,imageUrl:String,uploaderSize:{type:String,default:"large"},accept:{type:String,default:".jpg, .jpeg, .png"},isShowPreview:{type:Boolean,default:!0},sizeLimit:{type:Number,default:20},listType:{type:String,default:"picture-card"},onBeforeUpload:Function,onUploadSuccess:Function,onRemoveImage:Function,onUploadFail:Function,pixelLimit:Array,scaleLimit:Number},emits:["update:imageUrl"],setup(e,{emit:a}){const r=e,p=s(),m=s("https://adminapi.tobtt.cn/uploads/"),g=o({hideUpload:!1,fileList:[],imgPreviewDialogVisible:!1,file:null});b((()=>r.imageUrl),((e,a)=>{if(e){const e={name:r.imageUrl,url:`${m.value}${r.imageUrl}`};g.fileList=[e],g.hideUpload=!0,g.file=e}}));const f=()=>{g.hideUpload=!0},h=()=>{g.imgPreviewDialogVisible=!0},V=()=>{var e;g.fileList.shift(),g.file=null,g.hideUpload=!1,a("update:imageUrl",""),null==(e=r.onRemoveImage)||e.call(r)},F=e=>{var l,t;g.hideUpload=!0,null==(l=r.onUploadSuccess)||l.call(r,e),a("update:imageUrl",e),null==(t=p.value)||t.close()},_=e=>{var a;null==(a=r.onUploadFail)||a.call(r,e),setTimeout((()=>{V()}),0)};return(a,o)=>{const r=U,s=w;return l(),t("div",{class:u(["uploader-wrapper image-uploader",e.uploaderSize,{"hide-upload":c(g).hideUpload,"hide-preview":!e.isShowPreview}])},[v(N,{disabled:e.disabled,hideUpload:c(g).hideUpload,accept:e.accept,sizeLimit:e.sizeLimit,onBeforeUpload:e.onBeforeUpload,onRemove:V,onPreview:h,onChange:f,onUploadSuccess:F,onUploadFail:_,fileList:c(g).fileList},{default:n((()=>[v(r,{class:"avatar-uploader-icon"},{default:n((()=>[v(c(G))])),_:1})])),_:1},8,["disabled","hideUpload","accept","sizeLimit","onBeforeUpload","fileList"]),e.isShowPreview?(l(),d(s,{key:0,modal:!1,modelValue:c(g).imgPreviewDialogVisible,"onUpdate:modelValue":o[0]||(o[0]=e=>c(g).imgPreviewDialogVisible=e),title:"图片预览","custom-class":"preview-dialog",width:"600px"},{default:n((()=>[i("img",{src:m.value+e.imageUrl,alt:""},null,8,O)])),_:1},8,["modelValue"])):y("",!0)],2)}}}),[["__scopeId","data-v-b65cf72e"]]);const K={class:"warpper"},W={class:"operate-wrapper"},Q={class:"operate-left-btn"},X=D("新增"),Z=D("删除"),ee={class:"operate-right-btn"},ae=D("导入"),le=D("导出"),te=D("显示"),ie=D("隐藏"),oe=D("保存"),re=D("重置");var se=h(e({setup(e){const a=o({searchForm:{limit:10,page:1,title:"",type:""},formVisible:!1}),r=o({id:"",title:"",picture:"",type:"home",status:!0,describe:""}),d={home:"首页"},p=e=>{R.currentPage=1,a.searchForm=e,u()},u=async()=>{a.searchForm.page=R.currentPage,a.searchForm.limit=R.pageSize;const{list:e,total:l}=await(t=a.searchForm,V({url:"advertise",method:"get",params:t}));var t;R.data=e,R.total=l},g=s(),f=()=>{g.value.resetFields()},h=()=>{f(),r.id="",a.formVisible=!1},b=async()=>{var e,a;await g.value.validate(),r.id?await(e=r.id,a=r,V({url:`advertise/${e}`,method:"patch",data:a})):await(e=>V({url:"advertise",method:"post",data:e}))(r),u(),m({type:"success",message:r.id?"修改成功":"新增成功"}),h()},y=e=>{a.formVisible=!0,H((()=>{r.id=e.id,r.title=e.title,r.picture=e.picture,r.type=e.type}))},U=({id:e})=>{T.confirm("确定删除该广告, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(e=>V({url:`advertise/${e}`,method:"delete"}))(e),u(),m({type:"success",message:"删除成功!"})})).catch((()=>{}))},D=o({onClickSearch:p,onClickClear:p,filters:[{type:I.input,key:"title",label:"广告标题",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:I.select,key:"type",label:"广告位置",initialValue:"",options:[{label:"首页",value:"home"}],validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]}]}),R=o({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"广告标题",prop:"title"},{label:"广告位置",prop:"type",render:e=>d[e]},{label:"广告图",prop:"picture",width:"100",useSlot:!0},{label:"广告状态",prop:"status",render:e=>e?"显示":"隐藏"},{label:"广告描述",prop:"describe"},{label:"创建日期",prop:"createdAt",minWidth:"80",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"]}],operation:{label:"操作",width:"200",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit"},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDel"}]}}),E=o({title:[{required:!0,message:"请输入广告标题",trigger:"blur"}],status:[{required:!0,message:"请选择广告状态",trigger:"change"}],type:[{required:!0,message:"请选择广告位置",trigger:"change"}],picture:[{required:!0,message:"请上传广告图片",trigger:"change"}]}),{formVisible:Y}=F(a);return _((()=>{u()})),(e,a)=>{const o=S,s=B,d=x,p=z,m=L,V=P,F=w;return l(),t("div",K,[v(M,k(j(c(D))),null,16),i("div",W,[i("div",Q,[v(o,{plain:"",onClick:a[0]||(a[0]=e=>Y.value=!0)},{default:n((()=>[X])),_:1}),v(o,{plain:"",type:"danger"},{default:n((()=>[Z])),_:1})]),i("div",ee,[v(o,{type:"primary"},{default:n((()=>[ae])),_:1}),v(o,{type:"primary"},{default:n((()=>[le])),_:1})])]),v($,{tableOpts:c(R),onGetTableData:u,onHandleEdit:y,onHandleDel:U},{picture:n((e=>[v(A,{url:c("https://adminapi.tobtt.cn/uploads/")+e.value,size:64},null,8,["url"])])),_:1},8,["tableOpts"]),v(F,{title:(c(r).id?"编辑":"新增")+"广告",modelValue:c(Y),"onUpdate:modelValue":a[8]||(a[8]=e=>q(Y)?Y.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":h},{default:n((()=>[v(c(C),{ref_key:"formEle",ref:g,model:c(r),rules:c(E),"label-width":"100px",class:"demo-form"},{default:n((()=>[v(d,{label:"广告标题",prop:"title"},{default:n((()=>[v(s,{modelValue:c(r).title,"onUpdate:modelValue":a[1]||(a[1]=e=>c(r).title=e),placeholder:"请填写广告标题"},null,8,["modelValue"])])),_:1}),v(d,{label:"广告位置",prop:"type"},{default:n((()=>[v(m,{modelValue:c(r).type,"onUpdate:modelValue":a[2]||(a[2]=e=>c(r).type=e),placeholder:"请选择广告位置"},{default:n((()=>[v(p,{label:"首页",value:"home"})])),_:1},8,["modelValue"])])),_:1}),v(d,{label:"广告位置",prop:"picture"},{default:n((()=>[v(J,{class:"uploadFile",uploaderSize:"large",imageUrl:c(r).picture,"onUpdate:imageUrl":a[3]||(a[3]=e=>c(r).picture=e)},null,8,["imageUrl"])])),_:1}),v(d,{label:"广告状态",prop:"status"},{default:n((()=>[v(V,{modelValue:c(r).status,"onUpdate:modelValue":a[4]||(a[4]=e=>c(r).status=e),label:!0,size:"large"},{default:n((()=>[te])),_:1},8,["modelValue"]),v(V,{modelValue:c(r).status,"onUpdate:modelValue":a[5]||(a[5]=e=>c(r).status=e),label:!1,size:"large"},{default:n((()=>[ie])),_:1},8,["modelValue"])])),_:1}),v(d,{label:"描述：",prop:"describe"},{default:n((()=>[v(s,{modelValue:c(r).describe,"onUpdate:modelValue":a[6]||(a[6]=e=>c(r).describe=e),type:"textarea"},null,8,["modelValue"])])),_:1}),v(d,null,{default:n((()=>[v(o,{type:"primary",onClick:b},{default:n((()=>[oe])),_:1}),v(o,{onClick:a[7]||(a[7]=e=>f())},{default:n((()=>[re])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-666cf565"]]);export{se as default};
