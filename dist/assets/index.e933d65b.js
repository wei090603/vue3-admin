import{d as e,N as a,P as l,o as t,i,w as o,k as r,n as s,u as d,a1 as n,a0 as p,ap as u,O as c,c as m,a as g,aq as f,e as b,h,E as v,ar as y,as as U,at as w,au as V,av as _,aw as F,ax as S,ay as B,az as L,aA as P,aB as z,aC as x,R as k,B as j,aD as q,a2 as C}from"./vendor.2df3944f.js";/* empty css                  *//* empty css                 *//* empty css                  *//* empty css                */import{G as D,F as T,_ as H}from"./index.3a537d10.js";import{g as R,_ as $,s as A}from"./index.348ad088.js";import{I}from"./index.2cf9d96c.js";/* empty css                    */const M=e({props:{hideUpload:Boolean,disabled:Boolean,fileList:{type:Array,required:!0},accept:{type:String,default:".jpg, .jpeg, .png"},sizeLimit:{type:Number,default:20},listType:{type:String,default:"picture-card"},onBeforeUpload:Function,onBeforeUploadPromise:Function,onUploadSuccess:{type:Function,required:!0},onPreview:{type:Function,required:!0},onChange:{type:Function,required:!0},onRemove:{type:Function,required:!0},onUploadFail:{type:Function,required:!0}},setup(e){const c=e,m=a({uploadHeaders:{Authorization:"Bearer "+R()},file:null}),g=l(),f=e=>{const a=c.accept.includes(e.name.toLowerCase().split(".").pop()),l=e.size<=1024*c.sizeLimit*1024;a||n.error("文件格式不正确"),l||n.error(`文件大小必须小于 ${c.sizeLimit}MB`);if(!(a&&l))return!1;if(c.onBeforeUpload){const a=c.onBeforeUpload(e);if(a)return n.error(a),!1}return c.onBeforeUploadPromise?c.onBeforeUploadPromise(e).then((()=>(m.file=e,g.value=p.service({lock:!0,text:"上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),!0))).catch((e=>(n.error(e),Promise.reject(e)))):(m.file=e,g.value=p.service({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),!0)},b=(e,a)=>{var l,t,i,o;if(200===e.code){const{data:a}=e;null==(l=c.onUploadSuccess)||l.call(c,a.filename)}else n.error(e.message||"上传文件失败"),null==(t=c.onUploadFail)||t.call(c,e.message,m.file);null==(o=(i=g.value).close)||o.call(i)},h=()=>{var e,a,l;n.error("上传文件失败"),null==(e=c.onUploadFail)||e.call(c,"上传文件失败",m.file),null==(l=(a=g.value).close)||l.call(a)};return(a,l)=>{const n=u;return t(),i(n,{limit:1,"list-type":e.listType,accept:e.accept,class:s([{"hide-upload":e.hideUpload,"disabled-upload":e.disabled}]),disabled:e.disabled,data:{},action:"https://adminapi.tobtt.cn//upload/file",headers:d(m).uploadHeaders,"on-preview":e.onPreview,"on-change":e.onChange,"on-remove":e.onRemove,"before-upload":f,"on-success":b,"on-error":h,"file-list":e.fileList},{default:o((()=>[r(a.$slots,"default")])),_:3},8,["list-type","accept","class","disabled","headers","on-preview","on-change","on-remove","file-list"])}}});const E=["src"];var N=$(e({props:{disabled:Boolean,imageUrl:String,uploaderSize:{type:String,default:"large"},accept:{type:String,default:".jpg, .jpeg, .png"},isShowPreview:{type:Boolean,default:!0},sizeLimit:{type:Number,default:20},listType:{type:String,default:"picture-card"},onBeforeUpload:Function,onUploadSuccess:Function,onRemoveImage:Function,onUploadFail:Function,pixelLimit:Array,scaleLimit:Number},emits:["update:imageUrl"],setup(e,{emit:r}){const n=e,p=l(),u=l("https://adminapi.tobtt.cn/uploads/"),U=a({hideUpload:!1,fileList:[],imgPreviewDialogVisible:!1,file:null});c((()=>n.imageUrl),((e,a)=>{if(e){const e={name:n.imageUrl,url:`${u.value}${n.imageUrl}`};U.fileList=[e],U.hideUpload=!0,U.file=e}}));const w=()=>{U.hideUpload=!0},V=()=>{U.imgPreviewDialogVisible=!0},_=()=>{var e;U.fileList.shift(),U.file=null,U.hideUpload=!1,r("update:imageUrl",""),null==(e=n.onRemoveImage)||e.call(n)},F=e=>{var a,l;U.hideUpload=!0,null==(a=n.onUploadSuccess)||a.call(n,e),r("update:imageUrl",e),null==(l=p.value)||l.close()},S=e=>{var a;null==(a=n.onUploadFail)||a.call(n,e),setTimeout((()=>{_()}),0)};return(a,l)=>{const r=v,n=y;return t(),m("div",{class:s(["uploader-wrapper image-uploader",e.uploaderSize,{"hide-upload":d(U).hideUpload,"hide-preview":!e.isShowPreview}])},[g(M,{disabled:e.disabled,hideUpload:d(U).hideUpload,accept:e.accept,sizeLimit:e.sizeLimit,onBeforeUpload:e.onBeforeUpload,onRemove:_,onPreview:V,onChange:w,onUploadSuccess:F,onUploadFail:S,fileList:d(U).fileList},{default:o((()=>[g(r,{class:"avatar-uploader-icon"},{default:o((()=>[g(d(f))])),_:1})])),_:1},8,["disabled","hideUpload","accept","sizeLimit","onBeforeUpload","fileList"]),e.isShowPreview?(t(),i(n,{key:0,modal:!1,modelValue:d(U).imgPreviewDialogVisible,"onUpdate:modelValue":l[0]||(l[0]=e=>d(U).imgPreviewDialogVisible=e),title:"图片预览","custom-class":"preview-dialog",width:"600px"},{default:o((()=>[b("img",{src:u.value+e.imageUrl,alt:""},null,8,E)])),_:1},8,["modelValue"])):h("",!0)],2)}}}),[["__scopeId","data-v-120db87a"]]);const O={class:"warpper"},Y={class:"operate-wrapper"},G={class:"operate-left-btn"},W=j("新增"),J=j("删除"),K={class:"operate-right-btn"},Q=j("导入"),X=j("导出"),Z=j("显示"),ee=j("隐藏"),ae=j("保存"),le=j("重置");var te=$(e({setup(e){const i=a({searchForm:{limit:10,page:1,title:"",type:""},formVisible:!1}),r=a({id:"",title:"",picture:"",type:"home",status:!0,describe:""}),s={home:"首页"},p=e=>{M.currentPage=1,i.searchForm=e,u()},u=async()=>{i.searchForm.page=M.currentPage,i.searchForm.limit=M.pageSize;const{list:e,total:a}=await(l=i.searchForm,A({url:"advertise",method:"get",params:l}));var l;M.data=e,M.total=a},c=l(),f=()=>{c.value.resetFields()},h=()=>{f(),r.id="",i.formVisible=!1},v=async()=>{var e,a;await c.value.validate(),r.id?await(e=r.id,a=r,A({url:`advertise/${e}`,method:"patch",data:a})):await(e=>A({url:"advertise",method:"post",data:e}))(r),u(),n({type:"success",message:r.id?"修改成功":"新增成功"}),h()},j=e=>{i.formVisible=!0,q((()=>{r.id=e.id,r.title=e.title,r.picture=e.picture,r.type=e.type}))},R=({id:e})=>{C.confirm("确定删除该广告, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(e=>A({url:`advertise/${e}`,method:"delete"}))(e),u(),n({type:"success",message:"删除成功!"})})).catch((()=>{}))},$=a({onClickSearch:p,onClickClear:p,filters:[{type:D.input,key:"title",label:"广告标题",initialValue:"",validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]},{type:D.select,key:"type",label:"广告位置",initialValue:"",options:[{label:"首页",value:"home"}],validator:[{max:20,message:"请输入 20 个以内字符",trigger:["blur","change"]}]}]}),M=a({currentPage:1,pageSize:10,total:1,data:[],multipleTable:!0,multipleSelection:[],indexes:["序号"],dynamic:!0,hasOperation:!0,pagination:!0,pageHandleFunc:"getTableData",column:[{label:"广告标题",prop:"title"},{label:"广告位置",prop:"type",render:e=>s[e]},{label:"广告图",prop:"picture",width:"100",useSlot:!0},{label:"广告状态",prop:"status",render:e=>e?"显示":"隐藏"},{label:"广告描述",prop:"describe"},{label:"创建日期",prop:"createdAt",minWidth:"80",filterParams:["formatTime","YYYY-MM-DD HH:MM:ss"]}],operation:{label:"操作",width:"200",data:[{label:"编辑",type:"primary",icon:"el-icon-edit",handleFunc:"handleEdit"},{label:"删除",type:"danger",icon:"el-icon-delete",handleFunc:"handleDel"}]}}),E=a({title:[{required:!0,message:"请输入广告标题",trigger:"blur"}],status:[{required:!0,message:"请选择广告状态",trigger:"change"}],type:[{required:!0,message:"请选择广告位置",trigger:"change"}],picture:[{required:!0,message:"请上传广告图片",trigger:"change"}]}),{formVisible:te}=U(i);return w((()=>{u()})),(e,a)=>{const l=V,i=_,s=F,n=S,p=B,U=L,w=y;return t(),m("div",O,[g(T,P(z(d($))),null,16),b("div",Y,[b("div",G,[g(l,{plain:"",onClick:a[0]||(a[0]=e=>te.value=!0)},{default:o((()=>[W])),_:1}),g(l,{plain:"",type:"danger"},{default:o((()=>[J])),_:1})]),b("div",K,[g(l,{type:"primary"},{default:o((()=>[Q])),_:1}),g(l,{type:"primary"},{default:o((()=>[X])),_:1})])]),g(H,{tableOpts:d(M),onGetTableData:u,onHandleEdit:j,onHandleDel:R},{picture:o((e=>[g(I,{url:d("https://adminapi.tobtt.cn/uploads/")+e.value,size:64},null,8,["url"])])),_:1},8,["tableOpts"]),g(w,{title:(d(r).id?"编辑":"新增")+"广告",modelValue:d(te),"onUpdate:modelValue":a[8]||(a[8]=e=>k(te)?te.value=e:null),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"40%","before-close":h},{default:o((()=>[g(d(x),{ref_key:"formEle",ref:c,model:d(r),rules:d(E),"label-width":"100px",class:"demo-form"},{default:o((()=>[g(s,{label:"广告标题",prop:"title"},{default:o((()=>[g(i,{modelValue:d(r).title,"onUpdate:modelValue":a[1]||(a[1]=e=>d(r).title=e),placeholder:"请填写广告标题"},null,8,["modelValue"])])),_:1}),g(s,{label:"广告位置",prop:"type"},{default:o((()=>[g(p,{modelValue:d(r).type,"onUpdate:modelValue":a[2]||(a[2]=e=>d(r).type=e),placeholder:"请选择广告位置"},{default:o((()=>[g(n,{label:"首页",value:"home"})])),_:1},8,["modelValue"])])),_:1}),g(s,{label:"广告位置",prop:"picture"},{default:o((()=>[g(N,{class:"uploadFile",uploaderSize:"large",imageUrl:d(r).picture,"onUpdate:imageUrl":a[3]||(a[3]=e=>d(r).picture=e)},null,8,["imageUrl"])])),_:1}),g(s,{label:"广告状态",prop:"status"},{default:o((()=>[g(U,{modelValue:d(r).status,"onUpdate:modelValue":a[4]||(a[4]=e=>d(r).status=e),label:!0,size:"large"},{default:o((()=>[Z])),_:1},8,["modelValue"]),g(U,{modelValue:d(r).status,"onUpdate:modelValue":a[5]||(a[5]=e=>d(r).status=e),label:!1,size:"large"},{default:o((()=>[ee])),_:1},8,["modelValue"])])),_:1}),g(s,{label:"描述：",prop:"describe"},{default:o((()=>[g(i,{modelValue:d(r).describe,"onUpdate:modelValue":a[6]||(a[6]=e=>d(r).describe=e),type:"textarea"},null,8,["modelValue"])])),_:1}),g(s,null,{default:o((()=>[g(l,{type:"primary",onClick:v},{default:o((()=>[ae])),_:1}),g(l,{onClick:a[7]||(a[7]=e=>f())},{default:o((()=>[le])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-e0e78e56"]]);export{te as default};
